# 饿了么 & 美团回款数据统计系统

**呈尚策划** - 双平台回款综合分析系统

一个基于 Next.js 的饿了么和美团双平台代运营回款数据自动统计分析系统。

> 💾 **数据存储说明**: 本系统使用浏览器 localStorage 存储数据,无需服务器,支持纯静态部署到 GitHub Pages。所有数据处理在浏览器本地完成,保护数据隐私。

## 功能特性

### 📊 多平台数据统计
- **饿了么固定费用**：自动统计净结算金额为 33.95元 的店铺（35元 - 1.05元抽佣）
- **饿了么代运营回款**：每日线上回款数据统计
- **美团代运营回款**：每日线上回款数据统计（日期自动减1天）
- **综合统计**：三平台数据合并展示，自动计算每日总金额和总回款店铺数

### 📤 智能文件上传 (客户端处理)
- 支持三种数据类型上传：
  - 🔵 饿了么固定费用账单
  - 🟢 饿了么代运营回款账单
  - 🟠 美团代运营回款账单
- 支持 .xlsx 和 .xls 格式
- **浏览器端处理** Excel 文件,无需上传到服务器
- 自动识别数据类型并处理
- 实时更新统计结果
- 每日可重复上传更新数据
- 数据存储在浏览器 localStorage,刷新不丢失

### 📈 可视化数据展示
- **概览卡片**：四个渐变卡片展示总金额和分平台金额
- **趋势图表**：
  - 📊 每日总金额趋势图（玫瑰粉色系）
  - 👥 每日回款店铺数趋势图（青色系）
  - 平滑曲线动画效果
  - 交互式悬停提示
- **详细表格**：多平台每日数据对比表格
- **响应式设计**：完美适配桌面和移动设备

## 技术栈

- **框架**: Next.js 15 (App Router) + 静态导出
- **语言**: TypeScript
- **样式**: Tailwind CSS
- **图表**: Recharts
- **图标**: Lucide React
- **Excel处理**: xlsx (客户端)
- **数据存储**: localStorage (浏览器本地)

## 安装使用

### 1. 安装依赖

\`\`\`bash
npm install
\`\`\`

### 2. 启动开发服务器

\`\`\`bash
npm run dev
\`\`\`

访问 [http://localhost:3000](http://localhost:3000) 查看系统。

### 3. 上传Excel文件

1. 在页面中选择数据类型（饿了么固定费用/饿了么代运营/美团代运营）
2. 点击上传区域选择对应的Excel文件
3. 浏览器自动处理 Excel 并保存到 localStorage
4. 页面自动刷新显示最新统计数据

> **注意**: 数据存储在浏览器本地,清空浏览器缓存会丢失数据,建议保留 Excel 原始文件。

## Excel文件格式要求

### 1️⃣ 饿了么固定费用账单

必需字段：
- **店铺名称**：店铺的名称
- **门店ID**：店铺的唯一标识
- **合同开始时间**：合同生效日期
- **结算金额**：单条记录的结算金额
- **结算日期**：结算的日期

**计算逻辑**：
- 按"店铺ID + 结算日期"分组
- 固定费用结算: +35.00元
- 固定费用抽佣: -1.05元
- **净结算金额**: 33.95元
- 只统计净结算金额为 33.95元 的记录

### 2️⃣ 饿了么代运营回款账单

必需字段：
- **门店id**：店铺ID
- **代运营结算金额**：结算金额
- **账单日期**：账单日期

**计算逻辑**：
- 按账单日期分组
- 汇总每日代运营结算金额总和
- 统计每日回款店铺数

### 3️⃣ 美团代运营回款账单

必需字段：
- **代运营账单**：日期字段（第一列）
- **_1**：门店ID（第二列）
- **_4**：结算金额（元）（第五列）

**计算逻辑**：
- 跳过表头行
- **日期自动减1天**（因为美团数据标注的是下一天）
- 按调整后的日期分组
- 汇总每日结算金额总和
- 统计每日回款店铺数

## 统计展示

### 📊 概览卡片
- **饿了么固定费用**：蓝色卡片
- **饿了么代运营**：绿色卡片
- **美团代运营**：橙色卡片
- **总金额**：紫色卡片

### 📈 趋势图表
- **每日总金额趋势**：显示三平台每日总收入变化
- **每日回款店铺数趋势**：显示饿了么代运营和美团代运营的店铺数变化
- 注：图表自动过滤最后一天数据（因为美团数据晚一天，避免显示不完整数据）

### 📋 详细表格
包含9列数据：
- 日期
- 饿了么固定费用（金额、店铺数）
- 饿了么代运营（金额、店铺数）
- 美团代运营（金额、店铺数）
- 每日总计（总金额、总回款店铺数）

## 目录结构

\`\`\`
饿了么固定费用数据统计/
├── .github/
│   └── workflows/
│       └── deploy.yml               # GitHub Actions 自动部署配置
├── app/
│   ├── api/                         # API 路由(静态部署时不使用)
│   │   ├── upload/route.ts          # (已废弃,改用客户端处理)
│   │   └── clear-data/route.ts      # (已废弃,改用客户端处理)
│   ├── components/
│   │   ├── ClientHome.tsx           # 客户端主组件(使用 localStorage)
│   │   ├── AllPlatformsDailyStats.tsx  # 全平台每日统计表格
│   │   ├── DailyCharts.tsx          # 可视化趋势图表
│   │   ├── FileUpload.tsx           # 客户端 Excel 处理上传组件
│   │   └── ClearDataButton.tsx      # 客户端清空 localStorage 按钮
│   ├── layout.tsx                   # 布局组件
│   ├── page.tsx                     # 主页面入口
│   └── globals.css                  # 全局样式
├── public/data/                     # (仅用于开发,生产环境使用 localStorage)
│   ├── daily-stats.json             # 饿了么固定费用示例数据
│   ├── cycle-daily-stats.json       # 饿了么代运营示例数据
│   └── meituan-daily-stats.json     # 美团代运营示例数据
├── scripts/                         # 命令行工具(可选使用)
│   ├── processExcel.ts              # 饿了么固定费用处理脚本
│   ├── processCycleExcel.ts         # 饿了么代运营处理脚本
│   ├── processMeituanExcel.ts       # 美团代运营处理脚本
│   └── inspect*.ts                  # Excel查看工具
├── next.config.js                   # Next.js 配置(静态导出 + GitHub Pages)
├── package.json                     # 项目依赖
└── README.md                        # 项目文档
\`\`\`

## 命令行工具 (可选)

> **提示**: 生产环境已改用浏览器客户端处理,命令行工具仅用于开发调试。

### 批量处理Excel文件

如果需要在命令行中处理Excel文件(生成到 \`public/data/\` 用于开发测试)：

**处理饿了么固定费用：**
\`\`\`bash
npx tsx scripts/processExcel.ts
\`\`\`

**处理饿了么代运营回款：**
\`\`\`bash
npx tsx scripts/processCycleExcel.ts
\`\`\`

**处理美团代运营回款：**
\`\`\`bash
npx tsx scripts/processMeituanExcel.ts
\`\`\`

这些脚本会读取项目根目录下的Excel文件并生成统计数据到 \`public/data/\` 目录。

### 查看Excel文件结构

\`\`\`bash
npx tsx scripts/inspectExcel.ts          # 查看饿了么固定费用
npx tsx scripts/inspectCycleExcel.ts     # 查看饿了么代运营
npx tsx scripts/inspectMeituanExcel.ts   # 查看美团代运营
\`\`\`

查看Excel文件的列名和前几条数据示例。

## 部署

### 在线访问

🌐 **在线演示地址**: https://xuxikai886.github.io/shuangpingtaihuikuanshujutongji/

### 🚀 GitHub Pages 静态部署

本项目已针对 GitHub Pages 静态托管进行优化,所有功能在客户端运行,无需服务器支持。

#### 部署特点:
- ✅ **纯静态**: 使用 Next.js 静态导出(\`output: 'export'\`)
- ✅ **无服务器**: 所有数据处理在浏览器中完成
- ✅ **localStorage**: 数据存储在用户浏览器本地
- ✅ **自动部署**: GitHub Actions 自动构建和发布

#### GitHub Actions 自动部署流程:

1. **自动触发**: 推送到 master 或 main 分支会自动触发部署
2. **工作流配置**: \`.github/workflows/deploy.yml\`
3. **构建输出**: 自动生成静态站点到 GitHub Pages

**首次配置步骤**:
1. 进入 GitHub 仓库的 **Settings** → **Pages**
2. 在 "Build and deployment" 下选择 **Source**: \`GitHub Actions\`
3. 推送代码后,在 **Actions** 标签页查看部署状态
4. 部署成功后访问: \`https://[用户名].github.io/shuangpingtaihuikuanshujutongji/\`

#### 部署架构说明:
```
用户浏览器
├── 上传 Excel → xlsx 库解析 → 处理数据 → 存入 localStorage
├── 读取数据 → 从 localStorage 加载 → 渲染图表和表格
└── 清空数据 → 清除 localStorage → 刷新页面
```

所有操作完全在客户端完成,GitHub Pages 只提供静态文件托管。

### 本地构建和部署

**构建静态站点**:
\`\`\`bash
npm run build
\`\`\`

构建完成后会在 \`out/\` 目录生成静态文件。

**本地预览生产版本**:
\`\`\`bash
# 方法1: 使用 serve
npx serve@latest out

# 方法2: 使用 http-server
npx http-server out
\`\`\`

## 注意事项

### ⚠️ 数据处理规则
1. **饿了么固定费用**：只统计净结算金额为 33.95元 的店铺记录
2. **美团数据日期**：自动减1天处理（因为美团数据标注的是下一天）
3. **图表显示**：自动过滤最后一天数据（避免显示不完整的美团数据）
4. **数据更新**：上传新文件会覆盖对应类型的现有数据

### 💾 数据存储说明
1. **存储位置**: 所有数据保存在浏览器 localStorage 中
2. **数据隐私**: 数据不会上传到服务器,完全本地存储
3. **数据持久性**:
   - ✅ 刷新页面数据不会丢失
   - ✅ 关闭浏览器重新打开数据仍然存在
   - ❌ 清空浏览器缓存/Cookie 会丢失数据
   - ❌ 更换浏览器或设备数据不会同步
4. **数据备份**: 建议保留 Excel 原始文件作为备份

### 💡 使用建议
1. **文件格式**：确保Excel文件包含必需的列名
2. **数据类型**：上传前选择正确的数据类型
3. **浏览器兼容**：建议使用Chrome、Firefox、Edge等现代浏览器(需支持 localStorage)
4. **数据清空**：点击右上角"清空数据"按钮可清空所有平台数据
5. **定期备份**: 由于数据存储在浏览器本地,建议定期备份 Excel 原始文件
6. **浏览器限制**: localStorage 容量限制通常为 5-10MB,对于本系统的数据量完全足够

### 🎯 品牌信息
- **品牌名称**：呈尚策划
- **系统用途**：双平台回款数据综合分析
- **支持平台**：饿了么、美团

## 许可证

MIT License
