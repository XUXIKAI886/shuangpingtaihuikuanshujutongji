# 饿了么 & 美团回款数据统计系统

**呈尚策划** - 双平台回款综合分析系统

一个基于 Next.js 的饿了么和美团双平台代运营回款数据自动统计分析系统。

## 功能特性

### 📊 多平台数据统计
- **饿了么固定费用**：自动统计净结算金额为 33.95元 的店铺（35元 - 1.05元抽佣）
- **饿了么代运营回款**：每日线上回款数据统计
- **美团代运营回款**：每日线上回款数据统计（日期自动减1天）
- **综合统计**：三平台数据合并展示，自动计算每日总金额和总回款店铺数

### 📤 智能文件上传
- 支持三种数据类型上传：
  - 🔵 饿了么固定费用账单
  - 🟢 饿了么代运营回款账单
  - 🟠 美团代运营回款账单
- 支持 .xlsx 和 .xls 格式
- 自动识别数据类型并处理
- 实时更新统计结果
- 每日可重复上传更新数据

### 📈 可视化数据展示
- **概览卡片**：四个渐变卡片展示总金额和分平台金额
- **趋势图表**：
  - 📊 每日总金额趋势图（玫瑰粉色系）
  - 👥 每日回款店铺数趋势图（青色系）
  - 平滑曲线动画效果
  - 交互式悬停提示
- **详细表格**：多平台每日数据对比表格
- **响应式设计**：完美适配桌面和移动设备

## 技术栈

- **框架**: Next.js 15 (App Router)
- **语言**: TypeScript
- **样式**: Tailwind CSS
- **图表**: Recharts
- **图标**: Lucide React
- **Excel处理**: xlsx

## 安装使用

### 1. 安装依赖

\`\`\`bash
npm install
\`\`\`

### 2. 启动开发服务器

\`\`\`bash
npm run dev
\`\`\`

访问 [http://localhost:3000](http://localhost:3000) 查看系统。

### 3. 上传Excel文件

1. 在页面中选择数据类型（饿了么固定费用/饿了么代运营/美团代运营）
2. 点击上传区域选择对应的Excel文件
3. 系统自动处理并更新统计数据

## Excel文件格式要求

### 1️⃣ 饿了么固定费用账单

必需字段：
- **店铺名称**：店铺的名称
- **门店ID**：店铺的唯一标识
- **合同开始时间**：合同生效日期
- **结算金额**：单条记录的结算金额
- **结算日期**：结算的日期

**计算逻辑**：
- 按"店铺ID + 结算日期"分组
- 固定费用结算: +35.00元
- 固定费用抽佣: -1.05元
- **净结算金额**: 33.95元
- 只统计净结算金额为 33.95元 的记录

### 2️⃣ 饿了么代运营回款账单

必需字段：
- **门店id**：店铺ID
- **代运营结算金额**：结算金额
- **账单日期**：账单日期

**计算逻辑**：
- 按账单日期分组
- 汇总每日代运营结算金额总和
- 统计每日回款店铺数

### 3️⃣ 美团代运营回款账单

必需字段：
- **代运营账单**：日期字段（第一列）
- **_1**：门店ID（第二列）
- **_4**：结算金额（元）（第五列）

**计算逻辑**：
- 跳过表头行
- **日期自动减1天**（因为美团数据标注的是下一天）
- 按调整后的日期分组
- 汇总每日结算金额总和
- 统计每日回款店铺数

## 统计展示

### 📊 概览卡片
- **饿了么固定费用**：蓝色卡片
- **饿了么代运营**：绿色卡片
- **美团代运营**：橙色卡片
- **总金额**：紫色卡片

### 📈 趋势图表
- **每日总金额趋势**：显示三平台每日总收入变化
- **每日回款店铺数趋势**：显示饿了么代运营和美团代运营的店铺数变化
- 注：图表自动过滤最后一天数据（因为美团数据晚一天，避免显示不完整数据）

### 📋 详细表格
包含9列数据：
- 日期
- 饿了么固定费用（金额、店铺数）
- 饿了么代运营（金额、店铺数）
- 美团代运营（金额、店铺数）
- 每日总计（总金额、总回款店铺数）

## 目录结构

\`\`\`
饿了么固定费用数据统计/
├── app/
│   ├── api/
│   │   ├── upload/
│   │   │   └── route.ts             # 文件上传API（支持三种数据类型）
│   │   └── clear-data/
│   │       └── route.ts             # 清空数据API
│   ├── components/
│   │   ├── AllPlatformsDailyStats.tsx  # 全平台每日统计表格
│   │   ├── DailyCharts.tsx          # 可视化趋势图表
│   │   ├── FileUpload.tsx           # 智能文件上传组件
│   │   └── ClearDataButton.tsx      # 清空数据按钮
│   ├── layout.tsx                   # 布局组件
│   ├── page.tsx                     # 主页面
│   └── globals.css                  # 全局样式
├── public/data/
│   ├── daily-stats.json             # 饿了么固定费用数据
│   ├── cycle-daily-stats.json       # 饿了么代运营数据
│   └── meituan-daily-stats.json     # 美团代运营数据
├── scripts/
│   ├── processExcel.ts              # 饿了么固定费用处理脚本
│   ├── processCycleExcel.ts         # 饿了么代运营处理脚本
│   ├── processMeituanExcel.ts       # 美团代运营处理脚本
│   └── inspect*.ts                  # Excel查看工具
└── [配置文件]
\`\`\`

## 命令行工具

### 批量处理Excel文件

如果需要在命令行中处理Excel文件：

**处理饿了么固定费用：**
\`\`\`bash
npx tsx scripts/processExcel.ts
\`\`\`

**处理饿了么代运营回款：**
\`\`\`bash
npx tsx scripts/processCycleExcel.ts
\`\`\`

**处理美团代运营回款：**
\`\`\`bash
npx tsx scripts/processMeituanExcel.ts
\`\`\`

这些脚本会读取项目根目录下的Excel文件并生成统计数据到 \`public/data/\` 目录。

### 查看Excel文件结构

\`\`\`bash
npx tsx scripts/inspectExcel.ts          # 查看饿了么固定费用
npx tsx scripts/inspectCycleExcel.ts     # 查看饿了么代运营
npx tsx scripts/inspectMeituanExcel.ts   # 查看美团代运营
\`\`\`

查看Excel文件的列名和前几条数据示例。

## 部署

### GitHub Actions

项目配置了GitHub Actions自动部署。推送到main分支会自动触发部署流程。

### 手动部署

\`\`\`bash
npm run build
npm run start
\`\`\`

## 注意事项

### ⚠️ 数据处理规则
1. **饿了么固定费用**：只统计净结算金额为 33.95元 的店铺记录
2. **美团数据日期**：自动减1天处理（因为美团数据标注的是下一天）
3. **图表显示**：自动过滤最后一天数据（避免显示不完整的美团数据）
4. **数据更新**：上传新文件会覆盖对应类型的现有数据

### 💡 使用建议
1. **文件格式**：确保Excel文件包含必需的列名
2. **数据类型**：上传前选择正确的数据类型
3. **浏览器兼容**：建议使用Chrome、Firefox、Edge等现代浏览器
4. **数据清空**：点击右上角"清空数据"按钮可清空所有平台数据

### 🎯 品牌信息
- **品牌名称**：呈尚策划
- **系统用途**：双平台回款数据综合分析
- **支持平台**：饿了么、美团

## 许可证

MIT License
